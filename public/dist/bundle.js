var ReadMind=function(e){"use strict";const t="/api",n="readmind_token";function o(){localStorage.removeItem(n)}function a(){return localStorage.getItem(n)}function r(){const e=a();if(!e)return!1;try{const t=JSON.parse(atob(e.split(".")[1])),n=Math.floor(Date.now()/1e3);return t.exp>n}catch(e){return!1}}async function i(e){const r=a();if(!r)return Promise.resolve();const i=await fetch(`${t}/settings`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({settings:e})});if(!i.ok){if(401===i.status)try{await async function(){const e=a();if(!e)throw new Error("No token available");const o=await fetch(`${t}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})});if(!o.ok)throw new Error("Failed to refresh token");const r=await o.json();return localStorage.setItem(n,r.token),r.token}();const o=a(),r=await fetch(`${t}/settings`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({settings:e})});if(!r.ok)throw new Error("Could not save settings after token refresh");return await r.json()}catch(e){throw o(),new Error("Session expired. Please login again.")}throw new Error("Could not save settings")}return i.json()}const s="readMindSettings_v2",l="readMindIndex",c="readMindLastDocId",u="readMindHasVisited",d={currentLanguage:"ko",currentTheme:"blue",userHasManuallySetTheme:!1,originalPlaceholderText:"",encoder:new TextEncoder,fontFamily:"'Roboto', sans-serif",fontSize:48},m={words:[],currentIndex:0,currentWpm:250,isPaused:!1,isFixationPointEnabled:!1,chunkSize:1,readingMode:"flash",NO_SPACE_LANGUAGES:["ja","zh","ko"],engine:null},g={simplemde:null,activeDocument:null};let h=null;function p(){clearTimeout(h),h=setTimeout(async()=>{const e={theme:d.currentTheme,language:d.currentLanguage,wpm:m.currentWpm,chunkSize:m.chunkSize,isFixationPointEnabled:m.isFixationPointEnabled,readingMode:m.readingMode,fontFamily:d.fontFamily};try{localStorage.setItem(s,JSON.stringify(e))}catch(e){}if(r())try{await i(e)}catch(e){}},1500)}let y=null;async function f(){return y||new Promise((e,t)=>{kuromoji.builder({dicPath:"https://cdn.jsdelivr.net/npm/kuromoji/dict/"}).build((n,o)=>{n?t(n):(y=o,e(o))})})}async function S(){const e=function(e){if(!e)return"";let t=String(e);return t=t.replace(/^#{1,6}\s+/gm,""),t=t.replace(/\[([^\]]+)\]\([^)]+\)/g,"$1"),t=t.replace(/!\[[^\]]*\]\([^)]+\)/g,""),t=t.replace(/`([^`]+)`/g,"$1"),t=t.replace(/```[\s\S]*?```/g,""),t=t.replace(/(\*\*|__)(.*?)\1/g,"$2"),t=t.replace(/(\*|_)(.*?)\1/g,"$2"),t=t.replace(/~~(.*?)~~/g,"$1"),t=t.replace(/^\s*>\s*/gm,""),t=t.replace(/^\s*[-*+]\s+/gm,""),t=t.replace(/^\s*\d+\.\s+/gm,""),t=t.replace(/^[\s]*[-*_]{3,}[\s]*$/gm,""),t=t.replace(/^\|.*\|$/gm,""),t=t.replace(/^\|?\s*:?-+:?\s*\|.*$/gm,""),t=t.replace(/<[^>]*>/g,""),t=t.replace(/[\[\]"""'()（）<>【】『』「」`~@^|=+\\]/g,""),t=t.replace(/\s+/g," "),t=t.replace(/\n\s*\n/g,"\n"),t.trim()}(g.simplemde?g.simplemde.value():B.textInput?.value||"");if(!e.trim())return m.words=[],m.currentIndex=0,B.wordCountDisplay&&(B.wordCountDisplay.textContent="0"),B.charCountDisplay&&(B.charCountDisplay.textContent="0"),B.readingTimeDisplay&&(B.readingTimeDisplay.textContent="0"),B.progressInfoDisplay&&(B.progressInfoDisplay.textContent=""),void b();let t;t="ja"===d.currentLanguage?await async function(e,t){try{return(await t()).tokenize(e).map(e=>e.surface_form)}catch{return e.split("")}}(e,f):"ko"===d.currentLanguage?function(e){const t=[],n=e.split(/\s+/);for(const e of n)if(e.trim())if(/[\uAC00-\uD7AF\u1100-\u11FF\u3130-\u318F]/.test(e))if(e.length>6){const n=[];let o="";for(let t=0;t<e.length;t++)o+=e[t],(o.length>=3||t===e.length-1)&&(o.trim()&&n.push(o),o="");t.push(...n)}else t.push(e);else t.push(e);return t.filter(e=>e.length>0)}(e):m.NO_SPACE_LANGUAGES.includes(d.currentLanguage)?function(e){try{const t=new Intl.Segmenter(d.currentLanguage,{granularity:"word"});return Array.from(t.segment(e)).map(e=>e.segment)}catch(t){return e.split("")}}(e):e.trim().split(/\s+/).filter(Boolean);const n=t.length;if(m.words=function(e,t,n){if(!Array.isArray(e))return[];if(t>1&&!n){const n=[];for(let o=0;o<e.length;o+=t)n.push(e.slice(o,o+t).join(" "));return n}return e}(t,m.chunkSize,m.NO_SPACE_LANGUAGES.includes(d.currentLanguage)),B.wordCountDisplay&&(B.wordCountDisplay.textContent=n),B.charCountDisplay&&(B.charCountDisplay.textContent=e.length),B.readingTimeDisplay){const e=Math.ceil(n/(m.currentWpm/60));B.readingTimeDisplay.textContent=e}b(),function(e){const t={readabilityScore:"-",avgSentenceLength:"-",syllableCount:"-",lexicalDiversity:"-"};if(e&&""!==e.trim())try{const n=e.split(/[.!?\n]+/).filter(Boolean),o=(e.match(/\b\w+\b/g)||[]).map(e=>e.toLowerCase()),a=(e.match(/[aeiouAEIOU가-힣]/g)||[]).length,r=new Set(o).size,i=o.length,s=n.length||1;t.avgSentenceLength=(i/s).toFixed(1),t.syllableCount=a,t.lexicalDiversity=i>0?`${(r/i*100).toFixed(1)}%`:"0%",t.readabilityScore=(i/s*.39+a/Math.max(i,1)*11.8-15.59).toFixed(1)}catch(e){}B.readabilityScore&&(B.readabilityScore.textContent=String(t.readabilityScore));B.avgSentenceLength&&(B.avgSentenceLength.textContent=String(t.avgSentenceLength));B.syllableCount&&(B.syllableCount.textContent=String(t.syllableCount));B.lexicalDiversity&&(B.lexicalDiversity.textContent=String(t.lexicalDiversity))}(e)}async function v(e){const t="string"==typeof e?e:g.simplemde?g.simplemde.value():"";g.simplemde&&g.simplemde.value(t),m.isPaused=!1,m.currentIndex=0,await S(),T("initial"),B.currentWordDisplay&&(B.currentWordDisplay.innerHTML=w(L("statusReady"))),p(),localStorage.setItem(l,"0")}class x{constructor(e){this.getWords=e.getWords,this.onChunk=e.onChunk,this.onProgress=e.onProgress,this.onStatus=e.onStatus,this.onComplete=e.onComplete,this.getWpm=e.getWpm,this.getMode=e.getMode,this.index=0,this.timer=null,this.startDelayId=null,this.isPaused=!1}get intervalMs(){return 6e4/Math.max(50,Math.min(500,Number(this.getWpm?.()||250)))}getAdaptiveInterval(e){const t=this.intervalMs;if(!e)return t;const n=Array.isArray(e)?e.join(" "):String(e),o=n.length;let a=1;return o<=2?a=.9:o>=5?a=1.2:o>=4&&(a=1.05),/[0-9]/.test(n)&&(a*=1.2),/[^\w\s가-힣]/.test(n)&&(a*=1.1),Math.round(t*a)}resetToStart(){this.index=0}start(e=!1,t=1e3){const n=this.getWords?.()||[];0!==(Array.isArray(n)?n.length:0)?(e||this.resetToStart(),this.isPaused=!1,this.onStatus?.("statusPreparing"),clearTimeout(this.startDelayId),this.startDelayId=setTimeout(()=>{clearInterval(this.timer),this.tick(),this.scheduleNextTick()},e?0:t)):this.onStatus?.("msgNoWords")}tick(){const e=this.getWords?.()||[],t=e.length;if(this.index>=t)return void this.complete();const n=e[this.index],o=Array.isArray(n)?n.join(" "):String(n);this.onChunk?.(o),this.index+=1,this.onProgress?.(this.index,t),this.scheduleNextTick()}scheduleNextTick(){const e=this.getWords?.()||[];if(this.index<e.length&&!this.isPaused){const t=e[this.index],n=this.getAdaptiveInterval(t);this.timer=setTimeout(()=>this.tick(),n)}}pause(){clearTimeout(this.timer),this.timer=null,this.isPaused=!0,this.onStatus?.("statusPaused")}complete(){clearTimeout(this.timer),this.timer=null,this.onStatus?.("statusComplete"),this.onComplete?.()}updateSpeed(){this.timer&&!this.isPaused&&(clearTimeout(this.timer),this.scheduleNextTick())}}function b(){if(!B.progressBarFill)return;const e=m.words.length>0?m.currentIndex/m.words.length*100:0;B.progressBarFill.style.width=`${e}%`;const t=B.progressBarFill.parentElement;t&&t.setAttribute("aria-valuenow",Math.round(e).toString())}function w(e){if(!m.isFixationPointEnabled||!e||e.length<=1)return e;const t=Math.max(0,Math.floor(e.length/3)-(e.length>5?1:0));return t<0||t>=e.length?e:`${e.substring(0,t)}<span class="fixation-point">${e.charAt(t)}</span>${e.substring(t+1)}`}const B={mainCard:document.querySelector(".main-card"),documentSidebar:document.getElementById("document-sidebar"),sidebarOverlay:document.getElementById("sidebar-overlay"),textInput:document.getElementById("text-input"),currentWordDisplay:document.getElementById("current-word"),progressInfoDisplay:document.getElementById("progress-info"),progressBarFill:document.getElementById("progress-bar-fill"),startButton:document.getElementById("start-button"),pauseButton:document.getElementById("pause-button"),resetButton:document.getElementById("reset-button"),fullscreenButton:document.getElementById("fullscreen-button"),newDocumentButton:document.getElementById("new-document-button"),clearTextButton:document.getElementById("clear-text-button"),loginButton:document.getElementById("login-button"),logoutButton:document.getElementById("logout-button"),hamburgerMenuButton:document.getElementById("hamburger-menu-button"),closeSidebarButton:document.getElementById("close-sidebar-button"),wpmInput:document.getElementById("wpm-input"),darkModeToggle:document.getElementById("dark-mode-toggle"),themeToggleDarkIcon:document.getElementById("theme-toggle-dark-icon"),themeToggleLightIcon:document.getElementById("theme-toggle-light-icon"),themeSelector:document.getElementById("theme-selector"),fixationToggle:document.getElementById("fixation-toggle"),languageSelector:document.getElementById("language-selector"),chunkSizeSelector:document.getElementById("chunk-size-selector"),readingModeSelector:document.getElementById("reading-mode-selector"),fontFamilySelector:document.getElementById("font-family-selector"),fontSizeSlider:document.getElementById("font-size-slider"),fontSizeLabel:document.getElementById("font-size-label"),wordCountDisplay:null,charCountDisplay:null,readingTimeDisplay:null,readabilityScore:document.getElementById("readability-score"),avgSentenceLength:document.getElementById("avg-sentence-length"),syllableCount:document.getElementById("syllable-count"),lexicalDiversity:document.getElementById("lexical-diversity"),documentList:document.getElementById("document-list"),authModal:document.getElementById("auth-modal"),authForm:document.getElementById("auth-form"),emailInput:document.getElementById("email-input"),passwordInput:document.getElementById("password-input"),authSubmitButton:document.getElementById("auth-submit-button"),authCancelButton:document.getElementById("auth-cancel-button"),authSwitchButton:document.getElementById("auth-switch-button"),authModalTitle:document.getElementById("auth-modal-title")};function E(e,t){B.currentWordDisplay&&(B.currentWordDisplay.style.fontFamily=e,B.currentWordDisplay.style.fontSize=`${t}px`)}function I(e,t){e&&(document.body.setAttribute("data-theme",e),B.themeSelector&&B.themeSelector.value!==e&&(B.themeSelector.value=e)),document.documentElement.classList.toggle("dark",!!t),B.themeToggleDarkIcon&&(B.themeToggleDarkIcon.style.display=t?"inline-flex":"none"),B.themeToggleLightIcon&&(B.themeToggleLightIcon.style.display=t?"none":"inline-flex")}function L(e,t=d.currentLanguage,n=null){const o=translations[t]||translations.en;let a=o?.[e]||e;if(n&&"string"==typeof a)for(const e in n)a=a.replaceAll(`{${e}}`,n[e]);return a}function k(e,t=!1){d.currentLanguage=e,B.languageSelector&&(B.languageSelector.value=e),document.documentElement.lang=e,document.querySelectorAll("[data-lang-key]").forEach(t=>{const n=L(t.dataset.langKey,e);n&&n!==t.dataset.langKey&&(t.innerHTML=n)}),T(m.isPaused?"paused":"initial"),t||p()}function D(e,t="info",n=2e3){const o=document.getElementById("custom-message-box");o&&(o.querySelector("span").textContent=L(e),o.className=`message-box fixed top-5 left-1/2 -translate-x-1/2 p-4 rounded-md shadow-lg z-[1000] ${t}`,o.classList.add("show"),setTimeout(()=>o.classList.remove("show"),n))}function T(e){const t=B.textInput&&B.textInput.value.trim().length>0;switch(B.startButton.disabled=!0,B.pauseButton.disabled=!0,B.resetButton.disabled=!0,e){case"initial":t&&(B.startButton.disabled=!1);break;case"reading":B.pauseButton.disabled=!1,B.resetButton.disabled=!1;break;case"paused":t&&(B.startButton.disabled=!1),B.resetButton.disabled=!1;break;case"completed":B.resetButton.disabled=!1}B.startButton.textContent=L("paused"===e?"resumeButton":"startButton"),B.pauseButton.textContent=L("pauseButton"),B.resetButton.textContent=L("resetButton")}function C(){B.startButton?.addEventListener("click",()=>{!async function(e=!1){await S(),m.words&&0!==m.words.length?(e||(m.currentIndex=0,"teleprompter"===m.readingMode&&B.currentWordDisplay?(B.currentWordDisplay.innerHTML="",B.currentWordDisplay.style.textAlign="left",B.currentWordDisplay.style.overflowY="auto",B.currentWordDisplay.style.maxHeight="400px"):B.currentWordDisplay&&(B.currentWordDisplay.style.textAlign="center",B.currentWordDisplay.style.overflowY="visible",B.currentWordDisplay.style.maxHeight="none")),B.currentWordDisplay&&(m.readingMode,B.currentWordDisplay.innerHTML=w(L("statusPreparing"))),m.engine=new x({getWords:()=>m.words,getWpm:()=>m.currentWpm,getMode:()=>m.readingMode,onChunk:e=>{if(B.currentWordDisplay)if("teleprompter"===m.readingMode){const t=B.currentWordDisplay;t.innerHTML=t.innerHTML+" "+e,t.scrollTop=t.scrollHeight}else{const t=B.currentWordDisplay,n=m.currentWpm,o=120,a=60,r=200,i=400;t.innerHTML=w(e),t.style.transition="none",t.style.opacity="1",t.style.transform="translateY(0px)",n<r?(t.style.opacity="0",t.style.transform="translateY(5px)",t.offsetHeight,t.style.transition=`opacity ${o/1e3}s ease-out, transform ${o/1e3}s ease-out`,t.style.opacity="1",t.style.transform="translateY(0px)"):n<i&&(t.style.opacity="0.5",t.offsetHeight,t.style.transition=`opacity ${a/1e3}s ease-in-out`,t.style.opacity="1")}},onProgress:(e,t)=>{if(m.currentIndex=e,B.progressInfoDisplay){let n;n=m.NO_SPACE_LANGUAGES.includes(d.currentLanguage)?L("charsLabel"):m.chunkSize>1?L("chunksLabel"):L("wordsLabel"),B.progressInfoDisplay.textContent=L("progressLabelFormat",d.currentLanguage,{unit:n,current:e,total:t})}b()},onStatus:e=>{"msgNoWords"===e?D("msgNoWords","error"):B.currentWordDisplay&&(B.currentWordDisplay.innerHTML=w(L(e)))},onComplete:()=>{T("completed"),p(),localStorage.setItem(l,"0")}}),m.isPaused=!1,T("reading"),m.engine.start(e,1e3)):D("msgNoWords","error")}(m.isPaused&&m.currentIndex>0)}),B.pauseButton?.addEventListener("click",()=>{m.engine&&m.engine.pause(),m.isPaused=!0,T("paused"),p(),localStorage.setItem(l,m.currentIndex.toString())}),B.resetButton?.addEventListener("click",()=>{B.currentWordDisplay&&(B.currentWordDisplay.innerHTML=""),m.currentIndex=0,b(),T()}),B.wpmInput?.addEventListener("input",()=>{const e=parseInt(B.wpmInput.value,10);m.currentWpm=e,S(),p(),function(e){m.currentWpm=e,m.engine&&m.engine.updateSpeed()}(e)}),B.fontFamilySelector?.addEventListener("change",e=>{d.fontFamily=e.target.value,E(d.fontFamily,d.fontSize),p()}),B.fontSizeSlider?.addEventListener("input",e=>{const t=e.target.value;d.fontSize=t,B.fontSizeLabel&&(B.fontSizeLabel.textContent=L("fontSizeLabel",d.currentLanguage,{size:t})),E(d.fontFamily,d.fontSize),p()}),B.chunkSizeSelector?.addEventListener("change",async e=>{m.chunkSize=parseInt(e.target.value,10),B.textInput.value&&await v(B.textInput.value),p()}),B.fixationToggle?.addEventListener("change",e=>{const t=void 0!==e.target.selected?e.target.selected:e.target.checked;m.isFixationPointEnabled=t,p()}),B.readingModeSelector?.addEventListener("change",async e=>{m.readingMode=e.target.value,B.textInput.value&&await v(B.textInput.value),p()})}function M(){const e=r();B.loginButton&&B.loginButton.classList.toggle("hidden",e),B.logoutButton&&B.logoutButton.classList.toggle("hidden",!e),B.newDocumentButton&&B.newDocumentButton.classList.toggle("hidden",!e)}function A(e=!1){B.authModal&&(B.authModal.classList.remove("hidden"),B.authModalTitle&&(B.authModalTitle.textContent=L(e?"signupTitle":"loginTitle")),B.authSubmitButton&&(B.authSubmitButton.textContent=L(e?"signupButton":"loginButton")),B.authSwitchButton&&(B.authSwitchButton.textContent=L(e?"switchToLogin":"switchToSignup")))}function z(){B.authModal&&(B.authModal.classList.add("hidden"),B.authForm&&B.authForm.reset())}function P(){B.loginButton&&B.loginButton.addEventListener("click",()=>A(!1)),B.logoutButton&&B.logoutButton.addEventListener("click",()=>{_()}),B.authCancelButton&&B.authCancelButton.addEventListener("click",z),B.authSwitchButton&&B.authSwitchButton.addEventListener("click",e=>{e.preventDefault();A(!(B.authModalTitle?.textContent===L("signupTitle")))}),B.authForm&&B.authForm.addEventListener("submit",async e=>{e.preventDefault();const o=B.emailInput?.value||B.emailInput?.input?.value,a=B.passwordInput?.value||B.passwordInput?.input?.value,r=grecaptcha?.getResponse();if(!o||!a)return void D("msgEmailPasswordRequired","error");const i=B.authModalTitle?.textContent===L("signupTitle");if(i){if(!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*(),.?":{}|<>])[A-Za-z\d!@#$%^&*(),.?":{}|<>]{8,}$/.test(a))return void D("error_WEAK_PASSWORD","error")}if(r)try{let e;e=i?await async function(e,n,o){return(await fetch(`${t}/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:n,captchaToken:o})})).json()}(o,a,r):await async function(e,o,a){const r=await fetch(`${t}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:o,captchaToken:a})}),i=await r.json();return r.ok&&i.token&&localStorage.setItem(n,i.token),i}(o,a,r),e.token?(z(),await H(),D(i?"msgSignupSuccess":"msgLoginSuccess","success")):D(e.error_code||"msgAuthError","error")}catch(e){D("msgAuthError","error")}else D("msgCaptchaRequired","error")})}function W(){B.wordCountDisplay=document.querySelector("[data-stat='word-count']"),B.charCountDisplay=document.querySelector("[data-stat='char-count']"),B.readingTimeDisplay=document.querySelector("[data-stat='reading-time']"),B.languageSelector&&d.currentLanguage&&(B.languageSelector.value=d.currentLanguage),B.themeSelector&&document.body.getAttribute("data-theme")&&(B.themeSelector.value=document.body.getAttribute("data-theme")),C(),B.languageSelector?.addEventListener("change",e=>{const t=e.target.value;k(t),setTimeout(()=>{B.languageSelector.value!==t&&(B.languageSelector.value=t)},100)}),B.themeSelector?.addEventListener("change",e=>{const t=e.target.value;I(t,document.documentElement.classList.contains("dark")),p(),setTimeout(()=>{B.themeSelector.value!==t&&(B.themeSelector.value=t)},100)}),B.darkModeToggle?.addEventListener("click",()=>{const e=!document.documentElement.classList.contains("dark");document.documentElement.classList.toggle("dark",e),I(B.themeSelector?.value||"blue",e),B.darkModeToggle.setAttribute("aria-pressed",e.toString()),p()}),P(),B.hamburgerMenuButton&&B.hamburgerMenuButton.addEventListener("click",()=>{B.documentSidebar&&(B.documentSidebar.classList.remove("-translate-x-full"),B.hamburgerMenuButton.setAttribute("aria-expanded","true")),B.sidebarOverlay&&B.sidebarOverlay.classList.remove("hidden")}),B.closeSidebarButton&&B.closeSidebarButton.addEventListener("click",()=>{B.documentSidebar&&(B.documentSidebar.classList.add("-translate-x-full"),B.hamburgerMenuButton.setAttribute("aria-expanded","false")),B.sidebarOverlay&&B.sidebarOverlay.classList.add("hidden")}),B.sidebarOverlay&&B.sidebarOverlay.addEventListener("click",()=>{B.documentSidebar&&(B.documentSidebar.classList.add("-translate-x-full"),B.hamburgerMenuButton.setAttribute("aria-expanded","false")),B.sidebarOverlay.classList.add("hidden")}),B.newDocumentButton&&B.newDocumentButton.addEventListener("click",()=>{B.textInput&&(B.textInput.value="",g.simplemde&&g.simplemde.value(""),S(),p())}),B.clearTextButton&&B.clearTextButton.addEventListener("click",()=>{B.textInput&&(B.textInput.value="",g.simplemde&&g.simplemde.value(""),S(),p())})}let $;function F(e){g.activeDocument=e,localStorage.setItem(c,e.id),g.simplemde&&g.simplemde.value(e.content),B.textInput&&(B.textInput.value=e.content),document.querySelectorAll("#document-list > div").forEach(t=>{t.classList.toggle("bg-sky-100",t.dataset.id===String(e.id)),t.classList.toggle("dark:bg-sky-900",t.dataset.id===String(e.id))})}function N(){clearTimeout($),$=setTimeout(async()=>{if(g.activeDocument&&g.simplemde){const e=g.simplemde.value();if(e!==g.activeDocument.content)try{await async function(e,n,o){const r=a();if(!r)return Promise.reject("Not logged in");const i=await fetch(`${t}/documents/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({title:n,content:o})});if(!i.ok)throw new Error("Could not update document");return i.json()}(g.activeDocument.id,g.activeDocument.title,e),g.activeDocument.content=e}catch(e){D("msgSettingsSaveError","error")}}},1500)}async function j(){if(!r()){B.documentList.innerHTML='<p class="text-sm text-slate-500 p-4 text-center" data-lang-key="loginToSeeDocs"></p>';const e=B.documentList.querySelector('[data-lang-key="loginToSeeDocs"]');return void(e&&(e.textContent=L("loginToSeeDocs")))}try{const e=await async function(){const e=a();if(!e)return Promise.resolve([]);const n=await fetch(`${t}/documents`,{headers:{Authorization:`Bearer ${e}`}});if(!n.ok)throw 401===n.status&&o(),new Error("Could not fetch documents");return n.json()}(),n=B.documentList;if(n.innerHTML="",0===e.length){n.innerHTML='<p class="text-sm text-slate-500 p-4 text-center" data-lang-key="noDocuments"></p>';const e=n.querySelector('[data-lang-key="noDocuments"]');return void(e&&(e.textContent=L("noDocuments")))}e.forEach(e=>{const t=document.createElement("div");t.className="document-item p-3 border-b border-slate-200 dark:border-slate-700 cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-600 flex justify-between items-center",t.dataset.id=e.id;const o=document.createElement("div"),a=document.createElement("h3");a.className="font-semibold text-sm text-slate-800 dark:text-slate-200",a.textContent=e.title;const r=document.createElement("p");r.className="text-xs text-slate-500 dark:text-slate-400",r.textContent=`Updated: ${new Date(e.updated_at).toLocaleDateString()}`;const i=document.createElement("button");i.className="delete-doc-btn p-1 text-slate-400 hover:text-rose-500 dark:hover:text-rose-400 rounded-full",i.innerHTML='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>',i.dataset.id=e.id,i.title="Delete document",o.appendChild(a),o.appendChild(r),t.appendChild(o),t.appendChild(i),n.appendChild(t)})}catch(e){B.documentList.innerHTML='<p class="text-sm text-red-500 p-4 text-center" data-lang-key="errorLoadDocs"></p>';const t=B.documentList.querySelector('[data-lang-key="errorLoadDocs"]');t&&(t.textContent=L("errorLoadDocs"))}}function O(){B.documentList.addEventListener("click",async e=>{const n=e.target.closest(".document-item"),r=e.target.closest(".delete-doc-btn");if(r){e.stopPropagation();const n=r.dataset.id;!function(e,t,n){const o=document.getElementById("confirmation-modal-overlay"),a=document.getElementById("confirmation-modal-title"),r=document.getElementById("confirmation-modal-message"),i=document.getElementById("confirmation-modal-confirm-button"),s=document.getElementById("confirmation-modal-cancel-button");if(!(o&&a&&r&&i&&s))return;a.textContent=L(e),r.textContent=L(t),i.textContent=L("confirmButton"),s.textContent=L("cancelButton");const l=i.cloneNode(!0);i.parentNode.replaceChild(l,i);const c=s.cloneNode(!0);s.parentNode.replaceChild(c,s);const u=()=>o.classList.add("hidden");l.onclick=()=>{n(),u()},c.onclick=u,o.onclick=e=>{e.target===o&&u()},o.classList.remove("hidden")}("confirmDeleteDocTitle","confirmDeleteDocMessage",async()=>{try{await async function(e){const n=a();if(!n)return Promise.reject("Not logged in");const o=await fetch(`${t}/documents/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}});if(!o.ok)throw new Error("Could not delete document");return o.json()}(n),D("msgDocDeleted","success"),g.activeDocument&&g.activeDocument.id==n&&(g.activeDocument=null,g.simplemde&&g.simplemde.value("")),await j()}catch(e){D("msgDocDeleteError","error")}})}else if(n){const e=n.dataset.id;try{F(await async function(e){const n=a();if(!n)return Promise.reject("Not logged in");const r=await fetch(`${t}/documents/${e}`,{headers:{Authorization:`Bearer ${n}`}});if(!r.ok)throw 401===r.status&&o(),new Error("Could not fetch document");return r.json()}(e))}catch(e){D("msgDocLoadError","error")}}}),B.newDocumentButton.addEventListener("click",async()=>{const e=prompt("Enter a title for your new document:","New Document");if(e)try{const n=await async function(e,n=""){const o=a();if(!o)return Promise.reject("Not logged in");const r=await fetch(`${t}/documents`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({title:e,content:n})});if(!r.ok){const e=await r.json();throw new Error(e.message||"Could not create document")}return r.json()}(e,`# ${e}\n\n`);D("msgDocCreated","success"),await j(),F(n)}catch(e){D(e.message,"error")}}),g.simplemde&&g.simplemde.codemirror.on("change",function(e,t){let n;return function(...o){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...o)},t)}}(()=>{g.activeDocument&&N(),B.textInput&&(B.textInput.value=g.simplemde.value())},500)),B.startButton&&B.startButton.addEventListener("click",()=>{g.simplemde&&B.textInput.value!==g.simplemde.value()&&v(g.simplemde.value())},!0)}async function H(){M(),await j(),await q(),k(d.currentLanguage,!0),S()}function _(){o(),g.activeDocument=null,g.simplemde&&g.simplemde.value(""),M(),j()}async function q(){let e={};const n=localStorage.getItem(s);if(n)try{e=JSON.parse(n)}catch(e){}if(r())try{const n=await async function(){const e=a();if(!e)return Promise.resolve({});const n=await fetch(`${t}/settings`,{headers:{Authorization:`Bearer ${e}`}});if(!n.ok)throw 401===n.status&&o(),new Error("Could not fetch settings");return n.json()}();e={...e,...n}}catch(e){}!function(e){const t=e.language||navigator.language.split("-")[0]||"ko";d.currentLanguage=translations[t]?t:"ko";const n=e.darkMode??window.matchMedia("(prefers-color-scheme: dark)").matches,o=e.colorTheme||"blue";I(o,n),B.themeSelector&&(B.themeSelector.value=o),m.isFixationPointEnabled=e.isFixationPointEnabled||!1,B.fixationToggle&&(B.fixationToggle.selected=m.isFixationPointEnabled,B.fixationToggle.checked=m.isFixationPointEnabled),m.currentWpm=parseInt(e.wpm||"250",10),B.wpmInput&&(B.wpmInput.value=m.currentWpm),m.chunkSize=parseInt(e.chunkSize||"1",10),B.chunkSizeSelector&&(B.chunkSizeSelector.value=m.chunkSize),m.readingMode=e.readingMode||"flash",B.readingModeSelector&&(B.readingModeSelector.value=m.readingMode),d.fontFamily=e.fontFamily||"'Roboto', sans-serif",d.fontSize=e.fontSize||48,B.fontFamilySelector&&(B.fontFamilySelector.value=d.fontFamily),B.fontSizeSlider&&(B.fontSizeSlider.value=d.fontSize),B.fontSizeLabel&&(B.fontSizeLabel.textContent=getTranslation("fontSizeLabel",d.currentLanguage,{size:d.fontSize})),E(d.fontFamily,d.fontSize),e.text&&g.simplemde&&g.simplemde.value(e.text)}(e)}return document.addEventListener("DOMContentLoaded",async function(){try{if(document.getElementById("text-input")&&(g.simplemde=new SimpleMDE({element:document.getElementById("text-input"),spellChecker:!1,autosave:{enabled:!1},toolbar:["bold","italic","heading","|","quote","unordered-list","ordered-list","|","link","image","|","preview","side-by-side","fullscreen"]}),g.simplemde.codemirror.on("change",()=>{S(),p()}),g.simplemde.codemirror.on("inputRead",()=>{S()}),g.simplemde.codemirror.on("paste",()=>{setTimeout(()=>{S(),p()},100)})),await q(),M(),await j(),k(d.currentLanguage,!0),S(),T("initial"),b(),!localStorage.getItem(u)){const e=document.getElementById("welcome-dialog");e&&e.show(),localStorage.setItem(u,"true")}}catch(e){}finally{W(),O()}}),e.handleLogout=_,e.handleSuccessfulLogin=H,e}({});
//# sourceMappingURL=bundle.js.map
